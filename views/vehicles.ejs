<%- include('partials/header'); -%>
<div class="main-panel">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
    <div class="container-fluid">
      <div class="navbar-wrapper">
      </div>
      <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="navbar-toggler-icon icon-bar"></span>
        <span class="navbar-toggler-icon icon-bar"></span>
        <span class="navbar-toggler-icon icon-bar"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="javascript:;">
              <i class="material-icons">dashboard</i>
              <p class="d-lg-none d-md-block">
                Stats
              </p>
            </a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="material-icons">notifications</i>
              <span class="notification">5</span>
              <p class="d-lg-none d-md-block">
                Some Actions
              </p>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
              <a class="dropdown-item" href="#">Mike John responded to your email</a>
              <a class="dropdown-item" href="#">You have 5 new tasks</a>
              <a class="dropdown-item" href="#">You're now friend with Andrew</a>
              <a class="dropdown-item" href="#">Another Notification</a>
              <a class="dropdown-item" href="#">Another One</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link" href="javascript:;" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="material-icons">person</i>
              <p class="d-lg-none d-md-block">
                Account
              </p>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
              <a class="dropdown-item" href="#">Profile</a>
              <a class="dropdown-item" href="#">Settings</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">Log out</a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
<div class="content">
    <div class="card">
        <div class="card-header card-header-primary">
          <h4 class="card-title ">Vehicles</h4>
          <p class="card-category">Registered Vehicles</p>
        </div>
        <div class="card-body">
          <table id="example" class="table " style="width:100%">
              <thead class="thead-light">
                  <tr>
                      <th> Vehicle <i class="material-icons">swap_vert</i></th>
                      <th>Registation#<i class="material-icons">swap_vert</i></th>
                      <th>Color<i class="material-icons">swap_vert</i></th>
                      <th>Year<i class="material-icons">swap_vert</i></th>
                      <th>Owner<i class="material-icons">swap_vert</i></th>
                      <th>Mobile<i class="material-icons">swap_vert</i></th>
                      <th>Action<i class="material-icons">swap_vert</i></th> 
                  </tr>
              </thead>
              <tbody>
                <% databse.forEach(function(value) { %>
                  <tr>
                  <td><%= value.vehicle %></td>
                  <td><%= value.regnumber %></td>
                  <td><%= value.color %></td>
                  <td><%= value.year %></td>
                  <td><%= value.ownerName %></td>
                  <td><%= value.ownerMobile %></td>
                  <td><a onClick="deleteCar('<%= value.id %>')" class="btn btn-danger btn-sm text-white">Delete</a></td>
                </tr>
               <% }) %>
              </tbody>
             
          </table>
         </div>
   </div>
</div>
<script src="js/plugins/jquery-3.5.1.js"></script>
<script src="js/plugins/jquery.dataTables.min.js"></script>
<script src="js/plugins/jqueryui.min.js"></script>
<script src="js/plugins/rowGroup.min.js"></script>
<script>
    $(document).ready(function() {
        $('#example').DataTable( {
            order: [[2, 'asc']],
           // rowGroup: {
           //     dataSrc: 2
           // }
        } );
    } );
    $(document).ready(function() {
      navlinks= document.getElementsByClassName('nav-item'); 
      for(var i =0; i<navlinks.length; i++){
        var link = navlinks[i];
        link.className="nav-item"
      }
      document.getElementById('vehicles').className='nav-item active'
   
     } );

    function  deleteCar(id){
      const data = { id };
      
      fetch('/vehicles', {
        method: 'POST', // or 'PUT'
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.json())
      .then(data => {
        alert('Success:'+ data.message )
        console.log('Success:' ,data, data.status);
        setTimeout(()=>{
          location.reload();
        },3000);
      })
      .catch((error) => {
        alert('Failed' + error.message)
        console.error('Error:', error.message);
        setTimeout(()=>{
          location.reload();
        },3000)
      });
          }
</script>


<%- include('partials/footer'); -%>